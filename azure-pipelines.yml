trigger:
  branches:
    include:
      - main

variables:
  - group: cdp-core-pipeline-vars

stages:
  - template: templates/dev.yml

  - template: templates/test.yml

  - stage: ProdApproval
    dependsOn: DEV
    displayName: "Prod Approval"
    jobs:
      - job: WaitForApproval
        displayName: "Wait for Prod Approval"
        pool: 'server'
        steps:
          - task: ManualValidation@0
            inputs:
              instructions: 'Please approve the deployment to production.'
              onTimeout: 'reject'
              timeoutInMinutes: 180
              notifyUsers: |
                finn.tann@communities.gov.uk

  - template: templates/prod.yml


# TODO - tagging release branch
# TODO - variable passthrough for databricks.yml
# TODO - modularise
# TODO - add SIT tests
# TODO - fix unit test run (explore whl / job)
# TODO - investigate email notifications
# TODO - investigate running only speciic jobs on PR