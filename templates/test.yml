stages:
  - stage: TEST
    displayName: "TEST"
    dependsOn: DEV
    condition: succeeded('DEV')
    jobs:
      - job: targets
        displayName: "Deploy Test"
        steps:
          - script: |
              echo $(DATABRICKS_HOST)
              echo "Installing Databricks CLI"
              curl -fsSL https://raw.githubusercontent.com/databricks/setup-cli/main/install.sh | sh
            displayName: "Install Databricks CLI"

          # - task: AzureCLI@2
          #   condition: succeeded()
          #   displayName: "Deploy Databricks Bundle"
          #   inputs:
          #     azureSubscription: $(SPN_ID)
          #     useGlobalConfig: true
          #     scriptType: bash
          #     scriptLocation: inlineScript
          #     inlineScript: |
          #       set -e
          #       echo "Deploying Databricks Bundle"
          #       databricks bundle deploy --target test
          
          # - task: AzureCLI@2
          #   condition: succeeded()
          #   displayName: "System Integration Tests"
          #   inputs:
          #     azureSubscription: $(SPN_ID)
          #     useGlobalConfig: true
          #     scriptType: bash
          #     scriptLocation: inlineScript
          #     inlineScript: |
          #       databricks bundle run hello_job